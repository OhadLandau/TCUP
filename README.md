# TCUP â€“ Tissueâ€‘ofâ€‘Origin Prediction

**TCUP** (Tissue Classification Using Probabilities) is an openâ€‘access Dash webâ€‘application and model suite that predicts the most likely tissue of origin for:

* cancers of unknown primary (CUP)  
* any transcriptomic sample (e.g. TCGA, GTEx, metastatic, healthy)

The method couples a **Contrastive Autoâ€‘Encoder (CAE)** for representation learning with a **Siamese Neural Network (SNN)** metaâ€‘learner trained on curated TCGA, GTEx and metastatic cohorts. The embedding generated by both models are then fed to 5 base classifiers which are fine-tuned to elicit the best prediction through a Meta Learner (MLP).   For full methodology see the preâ€‘print:

> Landau O., RubinÂ E. â€œTCUPÂ â€“ Open Access Tool to Predict Tissue of Origin for Cancer of Unknown Primary (CUP) and Unknown Transcriptomic Samplesâ€ (in preparation, 2025).

---

## ğŸŒ³ Repository layout

```text
.
â”œâ”€â”€ DashAppTCUP.py                         # Dash front-end (entry-point)
â”œâ”€â”€ ExampleTranscriptomics.csv             # Toy input file
â”œâ”€â”€ Median_Gene_Values_Cancer.pkl          # Gene-wise medians â€“ cancer
â”œâ”€â”€ Median_Gene_Values_Healthy.pkl         # Gene-wise medians â€“ healthy
â”œâ”€â”€ best_meta_learner_8.h5                 # Final MLP meta-learner
â”œâ”€â”€ snn_model.h5                           # Siamese Neural Network backbone
â”œâ”€â”€ cae_autoencoder_dual_loss.h5           # Contrastive Auto-Encoder (full)
â”œâ”€â”€ cae_encoder.h5                         # Encoder only (inference-time)
â”œâ”€â”€ cae_decoder.h5                         # Decoder only
â”œâ”€â”€ trained_base_classifiers.pkl           # Five base classifiers (RF, XGB â€¦)
â”œâ”€â”€ monte_carlo_gene_importance_averaged.csv  # Gene-ablation scores (10 Ã— MC)
â”œâ”€â”€ test_split_metrics.csv                 # Per-class test metrics
â”‚
â”œâ”€â”€ assets/                                # CSS, logo, favicon
â”‚   â””â”€â”€ â€¦
â”œâ”€â”€ images/                                # Screenshots for the README
â”‚   â”œâ”€â”€ LandingPage.png
â”‚   â””â”€â”€ ResultsPage.png
â”œâ”€â”€ Raw Script/                            # End-to-end training pipeline
â”‚   â””â”€â”€ TCUP_raw_training_script.py
â””â”€â”€ README.md                              # <â€“â€“ you are here

```

### Key artefacts

| Path | Purpose |
|------|---------|
| **DashAppTCUP.py** | Launches the Dash UI & prediction pipeline |
| **Median_Gene_Values_Cancer.pkl** / **â€¦_Healthy.pkl** | Per-gene medians used to impute missing genes and calculate over/under-expression |
| **snn_model.h5** | Siamese Neural Network generating sample embeddings |
| **cae_autoencoder_dual_loss.h5** | Contrastive Auto-Encoder (joint loss) â€“ produces latent representation fed to base classifiers |
| **trained_base_classifiers.pkl** | Five fine-tuned base models (RF, XGB, LR, k-NN, SVM) that vote via the meta learner |
| **best_meta_learner_8.h5** | Multi-layer perceptron combining base classifier logits into final probabilities |
| **monte_carlo_gene_importance_averaged.csv** | Averaged single-gene ablation impact (10-run Monte-Carlo) â€“ drives the â€œ20 most influential genesâ€ list |
| **test_split_metrics.csv** | Held-out test-set metrics, used to display *TCUP accuracy* for each tissue |
| **ExampleTranscriptomics.csv** | Minimal example showing the required file format for uploads |

> **Note** â€“ raw expression matrices (TCGA, GTEx and metastatic cohorts) are **not included** due to size constraints. Contact *olandau4@gmail.com* to arrange data transfer if you plan to retrain TCUP.

---

## ğŸš€ QuickÂ start

```bash
# 1. clone repo
git clone https://github.com/<yourâ€‘user>/tcup.git
cd tcup

# 2. install deps
python -m venv venv && source venv/bin/activate  # optional
pip install -r requirements.txt

# 3. launch Dash server
python app/app.py
```

The app starts on **http://127.0.0.1:8050** by default.

---

## ğŸ–¼  UI tour

| Landing | Results |
|---------|---------|
| ![Landing page](images/LandingPage.png) | ![Results page](images/ResultsPage.png) |

* **Landing page** â€“ dragâ€‘andâ€‘drop a CSV/TSV where the **first column is `sample_id`** and the rest are *HGNC gene symbols*. Choose **Cancer** vs **Healthy** to select the assumed tissue type, this will add missing genes and compute the Over/Under expression of most significant genes in predicting the predicted label in your sample (from models intepertation stage - see paper) against the closest assumed reference data.  
* **Results page** â€“ shows:  
  1. 49 class probabilities (barplot), top to bottom, left to right.  
  2. Predicted tissue + modelâ€‘confidence (bold) - Probabilities and Models accuracy for that label on the test set.  
  3. **TCUP accuracy** â€“ historical accuracy for that tissue on an unseen test set (â‰ˆ accuracy for the given label).  
  4. The 20 most influential genes in the decision (blueÂ â–² = overâ€‘expressed; redÂ â–¼ = underâ€‘expressed).

---

## ğŸ“ˆ Interpreting the output

* **Predicted tissue** â€“ the label (e.g. `SKCM_TCGA`) with the highest posterior probability.  
* **Probability** â€“ the softmax score from the meta learner (0â€‘1).  
* **TCUP accuracy** â€“ *heldâ€‘out* testâ€‘set accuracy **for that tissue** only.  
  *Example*: â€œTCUP accuracyÂ â‰ˆÂ 96.7â€¯%â€ means that, across the unseen test set melanoma (SKCM) samples were 96.7â€¯%  correctly classified by TCUP.

If your sampleâ€™s probability is low (<0.4) or multiple tissues cluster tightly, treat the prediction with caution and consider further histopathological or molecular workâ€‘up. We would advise to utilize the tool merely as 'advice', this is not clinicaly verified and should not be applited in clinical practifce.  

---

## ğŸ›   Retraining

1. Taw expression matrices (TCGA, GTEx, metastatic) were not uploaded due to the significant size of the files, to use the data for potential retraining contact us - olandau4@gmail.com - and we will find a solution to transfer the data. 
2. Once data obtained, paths for the read_csv functions should be changed and matched to your enviorment.
3. install all depdencies (requirements.txt)
4. Run `python FullTCUP.py`.  


```
images/
â”œâ”€ landing_page.png
â””â”€ results_page.png
```
---

## ğŸ“œ Citation

If you use TCUP in academic work, please cite the forthcoming preâ€‘print:

```
Landau O., Rubin E. TCUP â€“ Open Access Tool to Predict Tissue of Origin
for Cancer of Unknown Primary (CUP) and Unknown Transcriptomic Samples. 2025.
```

---
