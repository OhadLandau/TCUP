# TCUP â€“ Tissueâ€‘ofâ€‘Origin Prediction

**TCUP** (Tissue Classification Using Probabilities) is an openâ€‘access Dash webâ€‘application and model suite that predicts the most likely tissue of origin for:

* cancers of unknown primary (CUP)  
* any transcriptomic sample (e.g. TCGA, GTEx, metastatic, healthy)

The method couples a **Contrastive Autoâ€‘Encoder (CAE)** for representation learning with a **Siamese Neural Network (SNN)** metaâ€‘learner trained on curated TCGA, GTEx and metastatic cohorts. The embedding generated by both models are then fed to 5 base classifiers which are fine-tuned to elicit the best prediction through a Meta Learner (MLP).   For full methodology see the preâ€‘print:

> Landau O., RubinÂ E. â€œTCUPÂ â€“ Open Access Tool to Predict Tissue of Origin for Cancer of Unknown Primary (CUP) and Unknown Transcriptomic Samplesâ€ (in preparation, 2025).

---

## ğŸŒ³ Repository layout

```
.
â”œâ”€ app/                     # Dash frontâ€‘end
â”‚   â”œâ”€ app.py
â”‚   â””â”€ assets/              # CSS, logo, favicon
â”œâ”€ models/                  # Preâ€‘trained weights & helpers
â”‚   â”œâ”€ tcup_cancer.pkl
â”‚   â”œâ”€ tcup_healthy.pkl
â”‚   â”œâ”€ medians_cancer.csv
â”‚   â”œâ”€ medians_healthy.csv
â”‚   â””â”€ label_encoder.pkl
â”œâ”€ RawÂ ModelÂ Script/        # Original endâ€‘toâ€‘end training pipeline
â”‚   â””â”€ TCUP_raw_training_script.py
â”œâ”€ images/                  # Screenshots for this README
â”‚   â”œâ”€ LandingPage.png
â”‚   â””â”€ ResultsPage.png
â”œâ”€ requirements.txt
â””â”€ README.md                # <â€“â€“ you are here
```

### Key artefacts

| Path | Purpose |
|------|---------|
| **models/tcup_cancer.pkl** | CAEÂ +Â SNN stack trained on *cancer* samples |
| **models/tcup_healthy.pkl** | Equivalent model trained on *healthy* tissues |
| **medians_cancer.csv** / **medians_healthy.csv** | Perâ€‘gene median expression used for graceful imputation when a gene is missing from the user upload |
| **RawÂ ModelÂ Script/** | Reproducible pipeline to retrain TCUP from scratch (data download âœ preprocessing âœ training âœ evaluation) |

---

## ğŸš€ QuickÂ start

```bash
# 1. clone repo
git clone https://github.com/<yourâ€‘user>/tcup.git
cd tcup

# 2. install deps
python -m venv venv && source venv/bin/activate  # optional
pip install -r requirements.txt

# 3. launch Dash server
python app/app.py
```

The app starts on **http://127.0.0.1:8050** by default.

---

## ğŸ–¼  UI tour

| Landing | Results |
|---------|---------|
| ![Landing page](images/LandingPage.png) | ![Results page](images/ResultsPage.png) |

* **Landing page** â€“ dragâ€‘andâ€‘drop a CSV/TSV where the **first column is `sample_id`** and the rest are *HGNC gene symbols*. Choose **Cancer** vs **Healthy** to select the assumed tissue type, this will add missing genes and compute the Over/Under expression of most significant genes in predicting the predicted label in your sample (from models intepertation stage - see paper) against the closest assumed reference data.  
* **Results page** â€“ shows:  
  1. 49 class probabilities (barplot), top to bottom, left to right.  
  2. Predicted tissue + modelâ€‘confidence (bold) - Probabilities and Models accuracy for that label on the test set.  
  3. **TCUP accuracy** â€“ historical accuracy for that tissue on an unseen test set (â‰ˆ accuracy for the given label).  
  4. The 20 most influential genes in the decision (blueÂ â–² = overâ€‘expressed; redÂ â–¼ = underâ€‘expressed).

---

## ğŸ“ˆ Interpreting the output

* **Predicted tissue** â€“ the label (e.g. `SKCM_TCGA`) with the highest posterior probability.  
* **Probability** â€“ the softmax score from the meta learner (0â€‘1).  
* **TCUP accuracy** â€“ *heldâ€‘out* testâ€‘set accuracy **for that tissue** only.  
  *Example*: â€œTCUP accuracyÂ â‰ˆÂ 96.7â€¯%â€ means that, across the unseen test set melanoma (SKCM) samples were 96.7â€¯%  correctly classified by TCUP.

If your sampleâ€™s probability is low (<0.4) or multiple tissues cluster tightly, treat the prediction with caution and consider further histopathological or molecular workâ€‘up. We would advise to utilize the tool merely as 'advice', this is not clinicaly verified and should not be applited in clinical practifce.  

---

## ğŸ›   Retraining

1. Taw expression matrices (TCGA, GTEx, metastatic) were not uploaded due to the significant size of the files, to use the data for potential retraining contact us - olandau4@gmail.com - and we will find a solution to transfer the data. 
2. Once data obtained, paths for the read_csv functions should be changed and matched to your enviorment.
3. install all depdencies (see all libraries on import, this is not a rebuild repo hence no requirements.txt file)
4. Run `python FullTCUP.py`.  


```
images/
â”œâ”€ landing_page.png
â””â”€ results_page.png
```
---

## ğŸ“œ Citation

If you use TCUP in academic work, please cite the forthcoming preâ€‘print:

```
Landau O., Rubin E. TCUP â€“ Open Access Tool to Predict Tissue of Origin
for Cancer of Unknown Primary (CUP) and Unknown Transcriptomic Samples. 2025.
```

---
