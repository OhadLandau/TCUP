# TCUP – Tissue‑of‑Origin Prediction

**TCUP** (Tissue Classification Using Probabilities) is an open‑access Dash web‑application and model suite that predicts the most likely tissue of origin for:

* cancers of unknown primary (CUP)  
* any transcriptomic sample (e.g. TCGA, GTEx, metastatic, healthy)

The method couples a **Contrastive Auto‑Encoder (CAE)** for representation learning with a **Siamese Neural Network (SNN)** meta‑learner trained on curated TCGA, GTEx and metastatic cohorts. The embedding generated by both models are then fed to 5 base classifiers which are fine-tuned to elicit the best prediction through a Meta Learner (MLP).   For full methodology see the pre‑print:

> Landau O., Rubin E. “TCUP – Open Access Tool to Predict Tissue of Origin for Cancer of Unknown Primary (CUP) and Unknown Transcriptomic Samples” (in preparation, 2025).

---

## 🌳 Repository layout

```
.
├─ app/                     # Dash front‑end
│   ├─ app.py
│   └─ assets/              # CSS, logo, favicon
├─ models/                  # Pre‑trained weights & helpers
│   ├─ tcup_cancer.pkl
│   ├─ tcup_healthy.pkl
│   ├─ medians_cancer.csv
│   ├─ medians_healthy.csv
│   └─ label_encoder.pkl
├─ Raw Model Script/        # Original end‑to‑end training pipeline
│   └─ TCUP_raw_training_script.py
├─ images/                  # Screenshots for this README
│   ├─ LandingPage.png
│   └─ ResultsPage.png
├─ requirements.txt
└─ README.md                # <–– you are here
```

### Key artefacts

| Path | Purpose |
|------|---------|
| **models/tcup_cancer.pkl** | CAE + SNN stack trained on *cancer* samples |
| **models/tcup_healthy.pkl** | Equivalent model trained on *healthy* tissues |
| **medians_cancer.csv** / **medians_healthy.csv** | Per‑gene median expression used for graceful imputation when a gene is missing from the user upload |
| **Raw Model Script/** | Reproducible pipeline to retrain TCUP from scratch (data download ➜ preprocessing ➜ training ➜ evaluation) |

---

## 🚀 Quick start

```bash
# 1. clone repo
git clone https://github.com/<your‑user>/tcup.git
cd tcup

# 2. install deps
python -m venv venv && source venv/bin/activate  # optional
pip install -r requirements.txt

# 3. launch Dash server
python app/app.py
```

The app starts on **http://127.0.0.1:8050** by default.

---

## 🖼  UI tour

| Landing | Results |
|---------|---------|
| ![Landing page](images/LandingPage.png) | ![Results page](images/ResultsPage.png) |

* **Landing page** – drag‑and‑drop a CSV/TSV where the **first column is `sample_id`** and the rest are *HGNC gene symbols*. Choose **Cancer** vs **Healthy** to select the assumed tissue type, this will add missing genes and compute the Over/Under expression of most significant genes in predicting the predicted label in your sample (from models intepertation stage - see paper) against the closest assumed reference data.  
* **Results page** – shows:  
  1. 49 class probabilities (barplot), top to bottom, left to right.  
  2. Predicted tissue + model‑confidence (bold) - Probabilities and Models accuracy for that label on the test set.  
  3. **TCUP accuracy** – historical accuracy for that tissue on an unseen test set (≈ accuracy for the given label).  
  4. The 20 most influential genes in the decision (blue ▲ = over‑expressed; red ▼ = under‑expressed).

---

## 📈 Interpreting the output

* **Predicted tissue** – the label (e.g. `SKCM_TCGA`) with the highest posterior probability.  
* **Probability** – the softmax score from the meta learner (0‑1).  
* **TCUP accuracy** – *held‑out* test‑set accuracy **for that tissue** only.  
  *Example*: “TCUP accuracy ≈ 96.7 %” means that, across the unseen test set melanoma (SKCM) samples were 96.7 %  correctly classified by TCUP.

If your sample’s probability is low (<0.4) or multiple tissues cluster tightly, treat the prediction with caution and consider further histopathological or molecular work‑up. We would advise to utilize the tool merely as 'advice', this is not clinicaly verified and should not be applited in clinical practifce.  

---

## 🛠  Retraining

1. Taw expression matrices (TCGA, GTEx, metastatic) were not uploaded due to the significant size of the files, to use the data for potential retraining contact us - olandau4@gmail.com - and we will find a solution to transfer the data. 
2. Once data obtained, paths for the read_csv functions should be changed and matched to your enviorment.
3. install all depdencies (see all libraries on import, this is not a rebuild repo hence no requirements.txt file)
4. Run `python FullTCUP.py`.  


```
images/
├─ landing_page.png
└─ results_page.png
```
---

## 📜 Citation

If you use TCUP in academic work, please cite the forthcoming pre‑print:

```
Landau O., Rubin E. TCUP – Open Access Tool to Predict Tissue of Origin
for Cancer of Unknown Primary (CUP) and Unknown Transcriptomic Samples. 2025.
```

---
